# Next Steps Tracker

Last updated: 2025-10-08

## Red Team Findings

| Priority | Area                    | Observation                                                                                                                                                                                                                       | Impact                                                                  | Recommendation                                                                                                                                                                                                                                      | Owner   | Status      |
| -------- | ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | ----------- |
| High     | Release supply chain    | `hephaestus release install` downloads wheelhouse archives over HTTPS but never verifies signatures or even checksums. A compromised GitHub release or CDN node could silently deliver poisoned wheels.                           | Supply-chain compromise risk for every consumer invoking the installer. | Publish a manifest with SHA-256/Sigstore attestations for each wheelhouse and verify before install; fail closed on mismatch. Pin the allowed repository/asset pattern and surface overrides behind an explicit `--allow-unsigned` escape hatch.    | Tooling | Open        |
| Medium   | Release networking      | `download_wheelhouse` performs blocking `urllib.request.urlopen` calls with default timeouts and zero retry logic. A slow or hostile endpoint can hang the CLI indefinitely.                                                      | Denial-of-service against CI pipelines and operators.                   | Add configurable timeouts, bounded retries with exponential backoff, and telemetry for repeated failures. Work-in-progress branch introduces retry helpers—needs completion and validation.                                                         | Tooling | In progress |
| High     | Cleanup ergonomics      | `cleanup` will happily scrub any `--extra-path` (even `/`), and when invoked outside a git repo it treats the CWD as root. A typo can wipe unrelated directories.                                                                 | Catastrophic operator error / accidental data loss.                     | Refuse to operate on paths outside the repo unless `--allow-outside-root` (with confirmation), disallow `/` and home directory targets, and emit a dry-run summary before deletion.                                                                 | DX      | Open        |
| Medium   | Guard rail availability | The `guard_rails` command is defined inside the `cleanup` function, so it is only registered after the cleanup command runs once per process. Fresh shells cannot invoke guard rails and therefore skip automated security scans. | Guard rails silently unavailable -> reduced local/AppSec coverage.      | Hoist `_format_command` and `guard_rails` to module scope, add a regression test that `cli.app.registered_commands` includes `guard-rails` pre-execution, and document expected usage. Current local edits regressed command wiring—needs re-hoist. | DX      | Blocked     |
| Low      | Asset name sanitisation | Release assets are written to disk using the server-provided filename without validating path separators. GitHub currently rejects `/`, but defensive sanitisation is advisable.                                                  | Future path traversal if upstream validation changes.                   | Strip `..`/path separators from asset names before joining paths and log when sanitisation occurs.                                                                                                                                                  | Tooling | Open        |

## Engineering Gaps & Opportunities

| Priority | Theme                        | Gap                                                                                                                       | Recommendation                                                                                                                                                                                              |
| -------- | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| High     | Secure development lifecycle | No `SECURITY.md` or published disclosure process; threat models live implicitly in docs.                                  | Add a `SECURITY.md`, document contact channels, expected SLAs, and link it from README & docs. Run a lightweight STRIDE-style threat model for the CLI + release pipeline and archive it under `docs/adr/`. |
| High     | Test reliability             | Pytest suites rely on running `cleanup` before `guard-rails`; this masks the registration bug and could regress silently. | Make tests order-independent (use pytest-randomly), restructure fixtures, and add explicit coverage for command registration.                                                                               |
| Medium   | Dependency hygiene           | Tooling pins (ruff 0.6.8, black 24.8.0, pip-audit ignore) are several releases behind as of Oct 2025.                     | Refresh `pyproject.toml` and `.pre-commit-config.yaml`, drop stale ignores once upstream patches land, and automate monthly dependency health checks beyond Dependabot (e.g., uv lockfile freshness).       |
| Medium   | Operational observability    | No telemetry around CLI/network failures; troubleshooting remote release installs is guesswork.                           | Emit structured logs/metrics (JSON events) for fetch/install stages and capture anonymised stats in CI (e.g., using OpenTelemetry exporters guarded behind env flags).                                      |
| Medium   | Documentation                | Cleanup safeguards, guard rail expectations, and release hardening steps are undocumented.                                | Add "Operating Safely" guide under `docs/how-to/` explaining cleanup constraints, guard-rail workflows, and release verification steps for contributors.                                                    |
| Low      | Incident readiness           | No documented rollback or release revocation procedure if a bad wheelhouse ships.                                         | Extend `docs/pre-release-checklist.md` with rollback guidance and automate revocation (delete releases, publish advisory).                                                                                  |

## Action Queue

1. **Secure the release channel** – land checksum/signature verification and timeout/backoff handling, then backfill signed artefacts for historical releases.
2. **Ship cleanup safety rails** – introduce protective defaults and update docs/tests to demonstrate safe usage.
3. **Unblock guard rails everywhere** – move the command registration to module scope, randomise pytest order, and add CI lint to prevent nested decorators.
   - [x] Guard-rails command registered at import time with regression test (`tests/test_cli.py`).
   - [ ] Restore CLI wiring after recent local regressions and add documentation snippet to README/Next Steps.
4. **Formalise AppSec posture** – publish `SECURITY.md`, threat model notes, and operational runbooks (rollback, telemetry, disclosure).
5. **Refresh automation dependencies** – bump pre-commit hooks and revisit the pip-audit CVE waiver once patched.
6. **Resynchronise with upstream** – fetch and merge `origin/main` to reconcile CLI and release command divergences before landing further changes.
